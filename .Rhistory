}
results <- tidycensus::get_acs(
geography = geography,
zcta = zcta,
state = state,
county = county,
survey = "acs5",
table = table
)
# return(results %>% filter(filter_zip & GEOID %in% houston_zip_codes))
return(results)
}
#load ages
houston_ages = call_tidycensus("city", "S0101")
texas_ages = call_tidycensus("state", "S0101")
View(texas_ages)
texas_ages = call_tidycensus("state", "S0101")
harrison_ages = call_tidycensus("county", "S0101")
View(harrison_ages)
#load ages
houston_ages = call_tidycensus("city", "S0101")
add_variable_names <- function(variables, data, variable_name) {
left_join(variables, data, by = c(variable_name = "variable")) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(age_demo_variables) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
houston_ages <- add_variable_names(age_variables, houston_ages, "age_demo_variables")
houston_ages <- add_variable_names(age_variables, houston_ages, "age_demo_variables")
View(houston_ages)
add_variable_names <- function(variables, data) {
left_join(variables, data, by = c(variables[1] = "variable")) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(age_demo_variables) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
add_variable_names <- function(variables, data) {
left_join(variables, data, by = c(variables[1] = "variable")) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(age_demo_variables) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
age_variables[1]
add_variable_names <- function(variables, data) {
left_join(variables, data, by = c(variables[1] = data[3])) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(age_demo_variables) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
add_variable_names <- function(variables, data) {
left_join(variables, data, by = c(variables[1] = data[3])) %>%
# select(-moe, -NAME, -GEOID) %>%
group_by(age_demo_variables) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
View(houston_ages)
age_variables <- data.frame(variable = age_demo_variables, age_demo_variable_names = age_demo_variable_names)
houston_ages <- add_variable_names(age_variables, houston_ages, "age_demo_variables")
age_demo_variables <- c(
"S0101_C01_001",
"S0101_C01_002",
"S0101_C01_003",
"S0101_C01_004",
"S0101_C01_005",
"S0101_C01_006",
"S0101_C01_007",
"S0101_C01_008",
"S0101_C01_009",
"S0101_C01_010",
"S0101_C01_011",
"S0101_C01_012",
"S0101_C01_013",
"S0101_C01_014",
"S0101_C01_015",
"S0101_C01_016",
"S0101_C01_017",
"S0101_C01_018"
)
age_demo_variable_names <- c(
"Total population",
"Under 5 years",
"5 to 9 years",
"10 to 14 years",
"15 to 19 years",
"20 to 24 years",
"25 to 29 years",
"30 to 34 years",
"35 to 39 years",
"40 to 44 years",
"45 to 49 years",
"50 to 54 years",
"55 to 59 years",
"60 to 64 years",
"65 to 69 years",
"70 to 74 years",
"75 to 79 years",
"80 to 84 years"
)
age_variables <- data.frame(variable = age_demo_variables, age_demo_variable_names = age_demo_variable_names)
add_variable_names <- function(variables, data) {
left_join(variables, data, by = c("variable")) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(age_demo_variables) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
houston_ages <- add_variable_names(age_variables, houston_ages)
add_variable_names <- function(variables, data) {
left_join(variables, data, by = c("variable")) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
houston_ages <- add_variable_names(age_variables, houston_ages)
View(houston_ages)
source('~/R/ACSAutomation/ACSAutomationScript.R', echo=TRUE)
View(texas_ages)
houston_ages <- add_variable_names(age_variables, houston_ages)
texas_ages <- add_variable_names(age_variables, texas_ages)
harrison_ages <- add_variable_names(age_variables, harrison_ages)
texas_ages["Total population"]
texas_ages[age_demo_variable_names]
texas_ages[age_demo_variable_names]
texas_ages[age_demo_variable_names = "Total population"]
texas_ages which(texas_ages$age_demo_variable_names == "Total population")
which(texas_ages$age_demo_variable_names == "Total population")
which(texas_ages$age_demo_variable_names == "Total population")
texas_ages[1,]
texas_ages[1,][estimate]
texas_ages[1,]["estimate"]
texas_ages[1,]["estimate"] + 3
View(harrison_ages)
View(houston_ages)
View(harrison_ages)
View(texas_ages)
View(houston_ages)
View(harrison_ages)
View(harrison_ages)
View(houston_ages)
View(texas_ages)
View(houston_ages)
View(texas_ages)
harris_z <- get_decennial(
geography = "zcta",
geometry = TRUE,
summary_var = "P001001",
cb = FALSE)
harris_z <- get_decennial(
geography = "zcta",
variables = c(white = "S0101"),
geometry = TRUE,
summary_var = "P001001",
cb = FALSE)
harris_z <- get_decennial(
geography = "zcta",
variables = c(White = "P005003", Black = "P005004", Asian = "P005006", Hispanic = "P004003"),
geometry = TRUE,
summary_var = "P001001",
cb = FALSE)
harris_z <- get_decennial(
geography = "zcta",
variables = c(White = "P005003", Black = "P005004", Asian = "P005006", Hispanic = "P004003"),
geometry = TRUE,
summary_var = "P001001",
cb = FALSE)
harris_z <- get_acs(
geography = "zcta",
survey="S0101",
geometry = TRUE,
summary_var = "P001001",
cb = FALSE)
harris_z <- get_acs(
geography = "zcta",
survey="S0101",
geometry = TRUE)
harris_z <- get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
geometry = TRUE)
View(harris_z)
harris_z_2 <- get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta=12211,
geometry = TRUE)
harris_z_2 <- get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta="ZCTA5 35586",
geometry = TRUE)
harris_z_2 <- get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta="ZCTA5 35586",
geometry = TRUE)
harris_z_2 <- get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta="ZCTA5 35586",
geometry = TRUE)
harris_z_2 <- get_acs(
geography = "zcta5",
survey="acs5",
table="S0101",
zcta="35586",
geometry = TRUE)
harris_z_2 <- get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta="ZCTA 35586",
geometry = TRUE)
harris_z_2 <- get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta="ZCTA 35586",
geometry = TRUE)
?tidycensus::get_acs
tidycensus::get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta="ZCTA 35586",
geometry = TRUE)
harris_z_2 <- tidycensus::get_acs(
geography = "zcta",
survey="acs5",
table="S0101",
zcta="ZCTA 35586",
geometry = TRUE)
harris_z_2 <- tidycensus::get_acs(
geography = "tract",
survey="acs5",
table="S0101",
state="TX",
geometry = TRUE)
View(harris_z_2)
source('~/R/ACSAutomation/ACSAutomationScript.R', echo=TRUE)
?tidycensus::load_variables
?tidycensus::load_variables(latest_year, "acs5")
b <- tidycensus::load_variables(latest_year, "acs5")
latest_fun
b <- function() { le <<- "yes"}
b()
le
variables <- tidycensus::load_variables(latest_year, "acs5/subject", cache = T)
View(variables)
st <- "Estimate!!Total!!Total population!!AGE!!10 to 14 years"
str_count(st, "!!")
strsplit(st, "!!")
tail(strsplit(st, "!!"))
tail(strsplit(st, "!!"), n=1)
tail(strsplit(st, "!!"), n=1)[4]
tail(strsplit(st, "!!"), n=1)[3]
tail(strsplit(st, "!!"), n=1)[2]
tail(strsplit(st, "!!"), n=1)
strsplit(st, "!!")
strsplit(st, "!!")[1]
class(strsplit(st, "!!"))
tail(strsplit(st, "!!"), 1)
strsplit(st, "!!").last
strsplit(st, "!!").last()
strsplit(st, "!!")[[1]]
strsplit(st, "!!")[[1]].last
tail(strsplit(st, "!!")[[1]], 1)
View(variables)
add_variable_names <- function(data) {
left_join(variable_names, data, by = c("label" = "variable")) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
houston_ages <- add_variable_names(houston_ages)
variable_names <- tidycensus::load_variables(latest_year, "acs5/subject", cache = T)
houston_ages <- add_variable_names(houston_ages)
#load ages
houston_ages = call_tidycensus("city", "S0101")
texas_ages = call_tidycensus("state", "S0101")
texas_ages <- add_variable_names(texas_ages)
View(variable_names)
texas_ages = call_tidycensus("state", "S0101")
#load census data api and set latest year
tidycensus::census_api_key("c26a4b8f1ec3d0bcee44f9e2ffd45a94a5f8c034", install = TRUE, overwrite = TRUE)
texas_ages = call_tidycensus("state", "S0101")
results
filter_zip
call_tidycensus <- function(geo, table) {
call_tidycensus <- function(geo, table) {
filter_zip = F
if(geo == "Texas" || geo == "state") {
state <- texas_acs_code
geography <- "state"
county <- NULL
zcta <- NULL
} else if(geo == "Harris County" || geo == "county" ) {
state <- texas_acs_code
geography <- "county"
county <- harris_county_acs_code
zcta <- NULL
} else if(geo == "Houston" || geo == "city") {
filter_zip <- T
state <- texas_acs_code
geography <- "zcta"
county <- NULL
zcta <- houston_zip_codes
}
results <- tidycensus::get_acs(
geography = geography,
zcta = zcta,
state = state,
county = county,
survey = "acs5",
table = table
)
if (filter_zip) {
return(results %>%
filter(GEOID %in% houston_zip_codes))
}
else {
return(results)
}
}
call_tidycensus <- function(geo, table) {
filter_zip = F
if(geo == "Texas" || geo == "state") {
state <- texas_acs_code
geography <- "state"
county <- NULL
zcta <- NULL
} else if(geo == "Harris County" || geo == "county" ) {
state <- texas_acs_code
geography <- "county"
county <- harris_county_acs_code
zcta <- NULL
} else if(geo == "Houston" || geo == "city") {
filter_zip <- T
state <- texas_acs_code
geography <- "zcta"
county <- NULL
zcta <- houston_zip_codes
}
results <- tidycensus::get_acs(
geography = geography,
zcta = zcta,
state = state,
county = county,
survey = "acs5",
table = table
)
if (filter_zip) {
return(results %>%
filter(GEOID %in% houston_zip_codes))
}
else {
return(results)
}
}
texas_ages = call_tidycensus("state", "S0101")
texas_ages <- add_variable_names(texas_ages)
View(texas_ages)
add_variable_names <- function(data) {
left_join(variable_names, data, by = c("label" = "variable")) %>%
select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages <- add_variable_names(texas_ages)
debugSource('~/R/ACSAutomation/helper_functions.R')
texas_ages <- add_variable_names(texas_ages)
data
data$variable
rlang::last_error()
add_variable_names <- function(data) {
new_data <- merge(variable_names, data, by.x = "label", by.y = "variable", all.x = TRUE)
new_data %>%
select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages <- add_variable_names(texas_ages)
debugSource('~/R/ACSAutomation/helper_functions.R')
debugSource('~/R/ACSAutomation/helper_functions.R')
texas_ages <- add_variable_names(texas_ages)
new_data
source('~/R/ACSAutomation/helper_functions.R')
source('~/R/ACSAutomation/helper_functions.R')
source('~/R/ACSAutomation/helper_functions.R')
texas_ages <- add_variable_names(texas_ages)
View(texas_ages)
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "label")) %>%
# select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages = call_tidycensus("state", "S0101")
texas_ages2 <- add_variable_names(texas_ages)
View(texas_ages2)
View(variable_names)
add_variable_names <- function(data) {
inner_join(data, variable_names, by = c("variable" = "label")) %>%
# select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
View(texas_ages)
View(texas_ages2)
View(texas_ages)
View(variable_names)
View(texas_ages)
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "name")) %>%
# select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
View(texas_ages2)
strsplit(st, "!!")[[1]].last
st = "!!y!!n"
strsplit(st, "!!")[[1]].last
strsplit(st, "!!")[[1]]
strsplit(st, "!!")[[1]].last()
strsplit(st, "!!")[[1]]
tail(strsplit(st, "!!")[[1]], 1)
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "name")) %>%
# select(-moe, -NAME, -GEOID) %>%
mutate(label = tail(strsplit(label, "!!")[[1]], 1)) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "name")) %>%
# select(-moe, -NAME, -GEOID) %>%
mutate(label = tail(strsplit(label, "!!")[[1]], 2)) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
tail(strsplit(st, "!!")[[1]], 2)
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "name")) %>%
# select(-moe, -NAME, -GEOID) %>%
mutate(label = ifelse(grepl("!!", label), tail(strsplit(label, "!!")[[1]], 2), label)) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
st = "Estimate!!Total!!Total population!!AGE!!Under 5 years"
tail(strsplit(label, "!!")[[1]], 2)
tail(strsplit(st, "!!")[[1]], 2)
join(tail(strsplit(st, "!!")[[1]], 2), ": ")
paste(tail(strsplit(st, "!!")[[1]], 2), ": ")
do.call(paste, c(as.list(sdata), sep = ""))
sdata = c('a', 'b', 'c')
do.call(paste, c(as.list(sdata), sep = ""))
paste(tail(strsplit(st, "!!")[[1]], 2), "")
paste(tail(strsplit(st, "!!")[[1]], 2), collapse=": ")
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "name")) %>%
# select(-moe, -NAME, -GEOID) %>%
mutate(label = ifelse(grepl("!!", label), paste(tail(strsplit(st, "!!")[[1]], 2), collapse=": "), label)) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "name")) %>%
# select(-moe, -NAME, -GEOID) %>%
mutate(label = ifelse(
grepl("!!", label),
paste(tail(strsplit(label, "!!")[[1]], 2),collapse=": "),
label)) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
st
add_variable_names <- function(data) {
left_join(data, variable_names, by = c("variable" = "name")) %>%
# select(-moe, -NAME, -GEOID) %>%
group_by(variable) %>%
mutate(estimate = sum(estimate)) %>%
distinct()
}
texas_ages2 <- add_variable_names(texas_ages)
